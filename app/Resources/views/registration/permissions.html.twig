{% extends 'base.html.twig' %}
{% block body %}
{{ include('templates/nav.html.twig') }}			 
<div id="page-wrapper">
        <div class="row">
            <div class="col-lg-12">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        Set Permissions for {{ user.fName }}
                    </div>
                    <div class="panel-body">
                        <div class="row">
                            <div class="col-lg-6">
                                  <div class="form-group">
                                    <label for="purchases">Purchases</label>
                                    <select class="form-control" id="purchases">
                                      <option value="0" {% if permissions['purchases'] is defined and permissions['purchases'].rights == 0 %} selected {% endif %}>No Access</option>
                                      <option value="1" {% if permissions['purchases'] is defined and permissions['purchases'].rights == 1 %} selected {% endif %}>Read Only</option>
                                      <option value="2" {% if permissions['purchases'] is defined and permissions['purchases'].rights == 2 %} selected {% elseif permissions is empty %} selected {% endif %}>Read And Write</option>
                                      <option value="3" {% if permissions['purchases'] is defined and permissions['purchases'].rights == 3 %} selected {% elseif user.admin == 1 %} selected {% endif %}>Full Controll</option>
                                    </select>
                                  </div>
                                  <div class="form-group">
                                    <label for="returns">Returns</label>
                                    <select class="form-control" id="returns">
                                      <option value="0" {% if permissions['returns'] is defined and permissions['returns'].rights == 0 %} selected {% endif %}>No Access</option>
                                      <option value="1" {% if permissions['returns'] is defined and permissions['returns'].rights == 1 %} selected {% endif %}>Read Only</option>
                                      <option value="2" {% if permissions['returns'] is defined and permissions['returns'].rights == 2 %} selected {% elseif permissions is empty %} selected {% endif %}>Read And Write</option>
                                      <option value="3" {% if permissions['returns'] is defined and permissions['returns'].rights == 3 %} selected {% elseif user.admin == 1 %} selected {% endif %}>Full Controll</option>
                                    </select>
                                  </div>
                                  <div class="form-group">
                                    <label for="sales">Sales</label>
                                    <select class="form-control" id="sales">
                                      <option value="0" {% if permissions['sales'] is defined and permissions['sales'].rights == 0 %} selected {% endif %}>No Access</option>
                                      <option value="1" {% if permissions['sales'] is defined and permissions['sales'].rights == 1 %} selected {% endif %}>Read Only</option>
                                      <option value="2" {% if permissions['sales'] is defined and permissions['sales'].rights == 2 %} selected {% elseif permissions is empty %} selected {% endif %}>Read And Write</option>
                                      <option value="3" {% if permissions['sales'] is defined and permissions['sales'].rights == 3 %} selected {% elseif user.admin == 1 %} selected {% endif %}>Full Controll</option>
                                    </select>
                                  </div>
                                  <div class="form-group">
                                    <label for="tax">Tax</label>
                                    <select class="form-control" id="tax">
                                      <option value="0" {% if permissions['tax'] is defined and permissions['tax'].rights == 0 %} selected {% endif %}>No Access</option>
                                      <option value="1" {% if permissions['tax'] is defined and permissions['tax'].rights == 1 %} selected {% endif %}>Read Only</option>
                                      <option value="2" {% if permissions['tax'] is defined and permissions['tax'].rights == 2 %} selected {% elseif permissions is empty %} selected {% endif %}>Read And Write</option>
                                      <option value="3" {% if permissions['tax'] is defined and permissions['tax'].rights == 3 %} selected {% elseif user.admin == 1 %} selected {% endif %}>Full Controll</option>
                                    </select>
                                  </div>
                                  <div class="form-group">
                                    <label for="stock_mov">Stock Movement</label>
                                    <select class="form-control" id="stock_mov">
                                      <option value="0" {% if permissions['stock_mov'] is defined and permissions['stock_mov'].rights == 0 %} selected {% endif %}>No Access</option>
                                      <option value="1" {% if permissions['stock_mov'] is defined and permissions['stock_mov'].rights == 1 %} selected {% endif %}>Read Only</option>
                                      <option value="2" {% if permissions['stock_mov'] is defined and permissions['stock_mov'].rights == 2 %} selected {% elseif permissions is empty %} selected {% endif %}>Read And Write</option>
                                      <option value="3" {% if permissions['stock_mov'] is defined and permissions['stock_mov'].rights == 3 %} selected {% elseif user.admin == 1 %} selected {% endif %}>Full Controll</option>
                                    </select>
                                  </div>
                           </div>
                            <!-- /.col-lg-6 (nested) -->
                            <div class="col-lg-6">
                                  <div class="form-group">
                                    <label for="sales_reports">Sales Reports</label>
                                    <select class="form-control" id="sales_reports">
                                      <option value="0" {% if permissions['sales_reports'] is defined and permissions['sales_reports'].rights == 0 %} selected {% endif %}>No Access</option>
                                      <option value="1" {% if permissions['sales_reports'] is defined and permissions['sales_reports'].rights == 1 %} selected {% endif %}>Read Only</option>
                                      <option value="2" {% if permissions['sales_reports'] is defined and permissions['sales_reports'].rights == 2 %} selected {% elseif permissions is empty %} selected {% endif %}>Read And Write</option>
                                      <option value="3" {% if permissions['sales_reports'] is defined and permissions['sales_reports'].rights == 3 %} selected {% elseif user.admin == 1 %} selected {% endif %}>Full Controll</option>
                                    </select>
                                  </div>
                                  <div class="form-group">
                                    <label for="stock_take">Stock Take</label>
                                    <select class="form-control" id="stock_take">
                                      <option value="0" {% if permissions['stock_take'] is defined and permissions['stock_take'].rights == 0 %} selected {% endif %}>No Access</option>
                                      <option value="1" {% if permissions['stock_take'] is defined and permissions['stock_take'].rights == 1 %} selected {% endif %}>Read Only</option>
                                      <option value="2" {% if permissions['stock_take'] is defined and permissions['stock_take'].rights == 2 %} selected {% elseif permissions is empty %} selected {% endif %}>Read And Write</option>
                                      <option value="3" {% if permissions['stock_take'] is defined and permissions['stock_take'].rights == 3 %} selected {% elseif user.admin == 1 %} selected {% endif %}>Full Controll</option>
                                    </select>
                                  </div>
                                  <div class="form-group">
                                    <label for="stock_adj">Stock Adjustment</label>
                                    <select class="form-control" id="stock_adj">
                                      <option value="0" {% if permissions['stock_adj'] is defined and permissions['stock_adj'].rights == 0 %} selected {% endif %}>No Access</option>
                                      <option value="1" {% if permissions['stock_adj'] is defined and permissions['stock_adj'].rights == 1 %} selected {% endif %}>Read Only</option>
                                      <option value="2" {% if permissions['stock_adj'] is defined and permissions['stock_adj'].rights == 2 %} selected {% elseif permissions is empty %} selected {% endif %}>Read And Write</option>
                                      <option value="3" {% if permissions['stock_adj'] is defined and permissions['stock_adj'].rights == 3 %} selected {% elseif user.admin == 1 %} selected {% endif %}>Full Controll</option>
                                    </select>
                                  </div>
                                  <div class="form-group">
                                    <label for="pos_summary">POS Summary</label>
                                    <select class="form-control" id="pos_summary">
                                      <option value="0" {% if permissions['pos_summary'] is defined and permissions['pos_summary'].rights == 0 %} selected {% endif %}>No Access</option>
                                      <option value="1" {% if permissions['pos_summary'] is defined and permissions['pos_summary'].rights == 1 %} selected {% endif %}>Read Only</option>
                                      <option value="2" {% if permissions['pos_summary'] is defined and permissions['pos_summary'].rights == 2 %} selected {% elseif permissions is empty %} selected {% endif %}>Read And Write</option>
                                      <option value="3" {% if permissions['pos_summary'] is defined and permissions['pos_summary'].rights == 3 %} selected {% elseif user.admin == 1 %} selected {% endif %}>Full Controll</option>
                                    </select>
                                  </div>
                                  <div class="form-group">
                                        <button class="btn btn-lg btn-primary col-lg-6" type="submit" id="saveSettings">Save</button>
                                        {# <button type="button" class="btn btn-lg btn-secondary col-lg-6" data-dismiss="modal">Cancel</button> #}
                                  </div>
                            </div>
                            <!-- /.col-lg-6 (nested) -->
                        </div>
                        <!-- /.row (nested) -->
                    </div>
                    <!-- /.panel-body -->
                </div>
                <!-- /.panel -->
            </div>
            <!-- /.col-lg-12 -->
        </div>
    </div>

{% endblock %}

{% block javascripts %}

      <script>
      $( "#saveSettings" ).click(function() {
          $.ajax({
              url:'{{ (path('save_permissions')) }}',
              type: "POST",
              dataType: "json",
              data: {
                  'purchases': $('#purchases').val(),
                  'returns': $('#returns').val(),
                  'tax': $('#tax').val(),
                  'sales': $('#sales').val(),
                  'stock_mov': $('#stock_mov').val(),
                  'stock_adj': $('#stock_adj').val(),
                  'stock_take': $('#stock_take').val(),
                  'pos_summary': $('#pos_summary').val(),
                  'sales_reports': $('#sales_reports').val(),
                  'user_id': {{ user.id }},
              },
              async: true,
              success: function (data)
              {
                  console.log(data.features_array);
                  location.href = "{{ path('homepage') }}";                  
              },
             error: function () {
                  console.log("something's wrong");
            }
          });

      });
      </script>

  {% endblock %}
